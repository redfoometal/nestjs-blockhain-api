# Документация по решению: Разработка и развертывание приложения с использованием Docker

## Введение

В данной документации описано решение для развертывания и управления приложением, использующим Docker и переменную окружения `NODE_ENV` для управления режимами разработки и продакшн-сборки. Это решение включает настройку контейнеров для базы данных (PostgreSQL) и API (Nest.js), а также запуск этих режимов через скрипт `start-containers.sh` для упрощения запуска.

Цель данного решения — обеспечить гибкость в процессе разработки, а также оптимизацию приложения для продакшн-окружения с помощью Docker и Docker Compose.

## Структура проекта

Проект включает в себя несколько ключевых компонентов:

- **`.env`** — файл для настройки переменных окружения, включая `NODE_ENV`, параметры подключения к базе данных и другие настройки.
- **`start-containers.sh`** — скрипт для запуска, остановки и очистки контейнеров в режиме разработки и продакшн.
- **`api.docker-compose.yaml`** — конфигурационный файл для контейнера API.
- **`api.Dockerfile`** — Dockerfile для сборки контейнера API в разных режимах.
- **`db.docker-compose.yaml`** — конфигурационный файл для контейнера базы данных.
- **`db.Dockerfile`** — Dockerfile для контейнера PostgreSQL.
- **`init.sql`** — скрипт для инициализации базы данных с тестовыми данными.

## Используемые технологии

- **Docker** и **Docker Compose** для развертывания и управления контейнерами.
- **Nest.js** для API.
- **PostgreSQL** в качестве базы данных.

## Описание решения

### 1. Переменная окружения `NODE_ENV`

Переменная окружения `NODE_ENV` используется для переключения между двумя основными режимами работы приложения:

- **development**: В этом режиме приложение запускается с монтированием исходных файлов в контейнер, что позволяет немедленно отражать изменения на хостовой машине. Это подходит для разработки, когда необходимо быстро проверять изменения в коде.
- **production**: В этом режиме приложение собирается с оптимизациями, и контейнеры запускаются в собранном виде, что обеспечит лучшую производительность для реального использования.

Для обоих режимом работы мы используем скрипт `start-containers.sh`, чтобы запустить контейнеры.

### 2. Скрипт `start-containers.sh`

Скрипт `start-containers.sh` автоматизирует процесс развертывания контейнеров в различных режимах. Он выполняет следующие действия:

- Проверяет наличие файла `.env`.
- Загружает настройки из файла `.env`.
- Запускает контейнеры для базы данных и API, учитывая выбранный режим работы (разработка или продакшн).
